<view class="profile-page-container {{isEditing ? 'edit-mode-active' : ''}}">
  <!-- Save Success Toast -->
  <view wx:if="{{showToast}}" class="toast">
    <text>{{toastMessage}}</text>
  </view>

  <!-- Profile Header -->
  <view wx:if="{{!isEditing}}" class="profile-header-section">
    <view class="profile-header-content">
      <image class="avatar" src="{{userInfo.avatar_url || 'https://via.placeholder.com/150'}}" mode="aspectFill"></image>
      <text class="username">{{userInfo.name || '未登录'}}</text>
      <button class="edit-button" bindtap="editProfile">编辑资料</button>
    </view>
  </view>

  <view class="content-area">
    <!-- Display Mode -->
    <view wx:if="{{!isEditing}}" class="display-mode">
      <view class="card">
        <view class="preview-area">
          <towxml nodes="{{renderedMarkdown}}"/>
        </view>
      </view>
    </view>

    <!-- Edit Mode -->
    <block wx:if="{{isEditing}}">
      <view class="card">
        <textarea id="profileMarkdown" class="profile-markdown-editor" value="{{editedContent}}" bindinput="onEditorInput" auto-height placeholder="请输入个人简介 (支持Markdown)" maxlength="20000"></textarea>
      </view>
    </block>
  </view>

  <!-- Sticky buttons, only shown in edit mode -->
  <view wx:if="{{isEditing}}" class="sticky-button-group">
    <button class="cancel-button" bindtap="cancelEdit">取消</button>
    <button class="save-button" bindtap="saveProfile">保存</button>
  </view>
</view>