<!--pages/opportunities/opportunities.wxml-->
<view class="page-container">
  <!-- Search and Filter Controls -->
  <view class="controls-container">
    <view class="search-bar">
      <icon class="search-icon" type="search" size="16"></icon>
      <input class="search-input" placeholder="搜索职位或公司..." bindinput="handleSearchInput" value="{{searchQuery}}"/>
    </view>
    <picker class="filter-picker" bindchange="handleFilterChange" value="{{activeFilterIndex}}" range="{{filterOptions}}">
      <view class="picker-view-filter">
        <text>{{filterOptions[activeFilterIndex]}}</text>
        <text class="dropdown-arrow">▼</text>
      </view>
    </picker>
  </view>

  <!-- Empty State -->
  <view wx:if="{{opportunities.length === 0}}" class="empty-state">
    <text class="empty-text">暂无求职机会</text>
    <text class="empty-subtext">点击下方按钮添加一个吧</text>
  </view>

  <!-- Opportunities List -->
  <view wx:else class="opportunities-list">
    <block wx:for="{{opportunities}}" wx:key="id">
      <view class="opportunity-card" data-status="{{item.status}}">
        <view class="card-content" bindtap="navigateToDetail" data-id="{{item.id}}">
          <view class="card-header">
            <text class="position-name">{{item.position_name}}</text>
            <view class="status-badge" data-status="{{item.status}}">{{item.status}}</view>
          </view>
          <view class="company-name">
            <text>{{item.company_name}}</text>
          </view>
          <view class="card-footer">
            <text class="footer-text">{{item.displayProgress}}</text>
            <view class="more-actions-btn" bindtap="showMoreActions" data-id="{{item.id}}">...</view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- Centered Floating Action Button -->
  <view class="fab-add-center" bindtap="handleAddButtonTap">
    <text class="fab-icon">+</text>
  </view>

  <!-- Add/Edit Opportunity Modal -->
  <view wx:if="{{isModalVisible}}" class="modal-backdrop" bindtap="hideModal">
    <view class="modal-panel" catchtap="doNothing">
      <view class="modal-header">
        <text class="modal-title">{{editingOpportunityId ? '编辑机会' : '添加新机会'}}</text>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <label class="form-label">公司名称*</label>
          <input value="{{formData.company_name}}" bindinput="handleInputChange" data-field="company_name" class="form-input" placeholder="请输入公司名称" />
        </view>
        <view class="form-group">
          <label class="form-label">职位名称*</label>
          <input value="{{formData.position_name}}" bindinput="handleInputChange" data-field="position_name" class="form-input" placeholder="请输入职位名称" />
        </view>
        <view class="form-group">
          <label class="form-label">投递状态</label>
          <picker name="status" mode="selector" range="{{statusOptions}}" value="{{selectedStatusIndex}}" bindchange="bindStatusChange">
            <view class="picker-view">{{formData.status}}</view>
          </picker>
        </view>
        <view class="form-group">
          <label class="form-label">最新进展 (选填)</label>
          <input value="{{formData.latest_progress}}" bindinput="handleInputChange" data-field="latest_progress" class="form-input" placeholder="例如: 等待二面通知" />
        </view>
        <view class="form-group">
          <label class="form-label">岗位描述 (选填)</label>
          <textarea value="{{formData.job_description}}" bindinput="handleInputChange" data-field="job_description" class="form-textarea" placeholder="请在此处粘贴岗位描述..."></textarea>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-button cancel" bindtap="hideModal">取消</button>
        <button class="modal-button save" bindtap="handleSaveOpportunity">保存</button>
      </view>
    </view>
  </view>
</view>